//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include "CoreScenario.h"
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CoreScenario
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CoreScenario::CoreScenario()
{
  actions = new CoreActionsList;
  isEnabled = true;
  currentActionIndex = 0;
  timer = 0;
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bool CoreScenario::enabled()
{
  return isEnabled;
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CoreScenario::enable()
{
  isEnabled = true;
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CoreScenario::disable()
{
  isEnabled = false;
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CoreScenario::clear()
{
  delete actions;
  actions = new CoreActionsList;
  currentActionIndex = 0;
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CoreScenario::add(CoreAction action)
{
  actions->push_back(action); 
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CoreScenario::update()
{
  if(!isEnabled || !actions->size())
    return;

   CoreAction* action = &((*actions)[currentActionIndex]);

   if(!timer) // first call
   {
    timer = micros();
   }
   
   if(micros() - timer > action->duration)
   {
      currentActionIndex++;
      
      if(currentActionIndex >= actions->size())
        currentActionIndex = 0;

       action = &((*actions)[currentActionIndex]);

       if(action->onAction)
        action->onAction(action->param);

      
       timer = micros();
   }
    
}
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------



